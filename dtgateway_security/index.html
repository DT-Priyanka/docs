<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Security - DataTorrent Documentation</title>
  

  <link rel="shortcut icon" href="../favicon.ico">
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../css/highlight.css">

  
  <script>
    // Current page data
    var mkdocs_page_name = "Security";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js"></script>
  <script src="../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../js/highlight.pack.js"></script>
  <script src="../js/theme.js"></script> 

  
  <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-44586211-1', 'docs.datatorrent.com');
      ga('send', 'pageview');
  </script>
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> DataTorrent Documentation</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <ul class="current">
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="..">DataTorrent RTS</a>
        
    </li>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Demos</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../demo_videos/">Videos</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../demos/">Running Apps</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../sandbox/">Sandbox</a>
        
    </li>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Development</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../create/">Creating Applications</a>
        
    </li>

        
            
    <ul class="subnav">
    <li><span>Tutorials</span></li>

        
            
    <ul class="subnav">
    <li><span>Top N Words</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../tutorials/topnwords/">Introduction</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../tutorials/topnwords-c1/">Development Environment</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../tutorials/topnwords-c2/">Building in Java</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../tutorials/topnwords-c3/">Building with dtAssemble</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../tutorials/topnwords-c4/">Monitoring with dtManage</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../tutorials/topnwords-c5/">Visualizing with dtDashboard</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../tutorials/topnwords-c6/">Appendix</a>
        
    </li>

        
    </ul>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../tutorials/sales_dimensions/">Sales Dimenions</a>
        
    </li>

        
    </ul>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../apex_development_setup/">Apex Development Setup</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../coming_soon/">Applications</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../application_packages/">Application Packages</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../configuration_packages/">Configuration Packages</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../coming_soon/">Operators</a>
        
    </li>

        
            
    <ul class="subnav">
    <li><span>Library Operators</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../operators/io/file_splitter/">File splitter</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../operators/io/block_reader/">Block reader</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../coming_soon/">File Input, S3, NFS</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../coming_soon/">File Output</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../coming_soon/">Deduper</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../coming_soon/">HDHT</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../coming_soon/">DimensionsStore</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../coming_soon/">DimenstionComputation</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../coming_soon/">KafkaInput</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../coming_soon/">KafkaOutput</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../coming_soon/">Solace</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../coming_soon/">JMS</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../coming_soon/">HBase</a>
        
    </li>

        
    </ul>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../dtgateway_api/">REST API</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../coming_soon/">Scalable Design</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Applications</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../dtingest/">dtIngest</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Platform</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../rts/">RTS</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../dtmanage/">dtManage</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../dtassemble/">dtAssemble</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../dtdashboard/">dtDashboard</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../coming_soon/">dtGateway</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../apex/">Apache Apex</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../apex_malhar/">Apache Apex-Malhar</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Deployment and Operations</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../coming_soon/">Quick Start</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../installation/">Installation</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../coming_soon/">Configuration</a>
        
    </li>

        
            
    <li class="toctree-l1 current">
        <a class="current" href="./">Security</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#datatorrent-gateway-security">DataTorrent Gateway Security</a></li>
                
            
                <li class="toctree-l3"><a href="#configuring-authentication">Configuring Authentication</a></li>
                
                    <li><a class="toctree-l4" href="#enabling-password-auth">Enabling Password Auth</a></li>
                
                    <li><a class="toctree-l4" href="#enabling-kerberos-auth">Enabling Kerberos Auth</a></li>
                
                    <li><a class="toctree-l4" href="#enabling-jaas-auth">Enabling JAAS Auth</a></li>
                
            
                <li class="toctree-l3"><a href="#configuring-authorization">Configuring Authorization</a></li>
                
                    <li><a class="toctree-l4" href="#permissions">Permissions</a></li>
                
                    <li><a class="toctree-l4" href="#default-roles">Default Roles</a></li>
                
                    <li><a class="toctree-l4" href="#app-permissions-and-app-package-permissions">App Permissions and App Package Permissions</a></li>
                
            
                <li class="toctree-l3"><a href="#viewing-and-managing-auth-in-the-console">Viewing and Managing Auth in the Console</a></li>
                
                    <li><a class="toctree-l4" href="#viewing-user-profile">Viewing User Profile</a></li>
                
            
                <li class="toctree-l3"><a href="#kerberos-roles">Kerberos roles </a></li>
                
            
                <li class="toctree-l3"><a href="#jaas-roles">JAAS roles </a></li>
                
                    <li><a class="toctree-l4" href="#callback-handlers">Callback Handlers</a></li>
                
                    <li><a class="toctree-l4" href="#ldap_1">LDAP</a></li>
                
            
                <li class="toctree-l3"><a href="#external-role-mapping">External Role Mapping </a></li>
                
            
                <li class="toctree-l3"><a href="#administering-using-command-line">Administering Using Command Line </a></li>
                
                    <li><a class="toctree-l4" href="#log-in-as-admin">Log in as admin:</a></li>
                
                    <li><a class="toctree-l4" href="#changing-the-admin-password">Changing the admin password:</a></li>
                
                    <li><a class="toctree-l4" href="#adding-a-second-admin-user">Adding a second admin user:</a></li>
                
                    <li><a class="toctree-l4" href="#adding-a-user-in-the-developer-role">Adding a user in the developer role:</a></li>
                
                    <li><a class="toctree-l4" href="#listing-all-users">Listing all users:</a></li>
                
                    <li><a class="toctree-l4" href="#getting-info-for-a-specific-user">Getting info for a specific user:</a></li>
                
                    <li><a class="toctree-l4" href="#removing-a-user">Removing a user:</a></li>
                
            
                <li class="toctree-l3"><a href="#enabling-https-in-gateway">Enabling HTTPS in Gateway</a></li>
                
            
            </ul>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../coming_soon/">dtCli</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../coming_soon/">Troubleshooting</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../glossary/">Glossary</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../additional_docs/">Resources</a>
        
    </li>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">DataTorrent Documentation</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
        
          <li>Deployment and Operations &raquo;</li>
        
      
    
    <li>Security</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="datatorrent-gateway-security">DataTorrent Gateway Security</h1>
<p>DataTorrent Gateway supports different authentication mechanisms to
secure access to the Console. The supported types are local password
authentication, kerberos authentication and J</p>
<h1 id="configuring-authentication">Configuring Authentication</h1>
<p>After DataTorrent RTS installation, you can turn on authentication and
authorization support to secure the DataTorrent Gateway. Gateway
supports three types of authentication.</p>
<ul>
<li>Password</li>
<li>Kerberos</li>
<li>JAAS</li>
</ul>
<h2 id="enabling-password-auth">Enabling Password Auth</h2>
<p>“Password” is the only authentication mechanism presented here that does
not depend on any external systems.  When enabled, all users will be
presented with the login prompt before being able to use the DT Console.
Password authentication can be enabled by performing following two
steps.</p>
<ol>
<li>
<p>Add a property to <code>dt-site.xml</code> configuration file, typically located
    under <code>/opt/datatorrent/current/conf</code> ( or <code>~/datatorrent/current/conf</code> for local install).</p>
<pre><code>&lt;configuration&gt;
...
    &lt;property&gt;
    &lt;name&gt;dt.gateway.http.authentication.type&lt;/name&gt;
    &lt;value&gt;password&lt;/value&gt;
    &lt;/property&gt;
...
&lt;/configuration&gt;
</code></pre>
</li>
<li>
<p>Restart the Gateway by running</p>
<pre><code>sudo service dtgateway restart
</code></pre>
<p>( when running Gateway in local mode use  dtgateway restart command)</p>
</li>
</ol>
<p>Open the Gateway URL in your browser, and you should be prompted for
user name and password.  Starting with DataTorrent RTS 2.0.0, the
default username and password is <strong>dtadmin</strong> and <strong>dtadmin</strong>.</p>
<p><img alt="" src="../images/GatewaySecurity/image02.png" /></p>
<p>Once authenticated, active user name and an option to log out is
presented in the top right corner of the DT Console screen.</p>
<p><img alt="" src="../images/GatewaySecurity/image00.png" /></p>
<h2 id="enabling-kerberos-auth">Enabling Kerberos Auth</h2>
<p>Kerberos authentication can optionally be enabled for Hadoop web access.
If this is configured then all web browser access to the Hadoop
management consoles is Kerberos authenticated. Access to all the web
services is also Kerberos authenticated. This Kerberos authentication is
performed using a protocol called SPNEGO which is Kerberos over HTTP.
Please refer to the administration guide of your Hadoop distribution on
how to enable this. The web browsers must also support SPNEGO, most
modern browsers do and should be configured to use SPNEGO for the
specific URLs being accessed. Please refer to the documentation of the
individual browsers on how to configure this. Gateway handles the SPNEGO
authentication needed when communicating with the Hadoop web-services if
Kerberos authentication is enabled for Hadoop web access.</p>
<p>Kerberos authentication can be enabled for UI Console as well. When it
is enabled access to the Gateway web-services is Kerberos authenticated.
The browser should be configured for SPNEGO authentication when
accessing the Console. A user typically obtains a master ticket first by
logging in to kerberos system in a terminal emulator using kinit. Then
the user launches a browser and accesses the Console URL. The browser
will use the master ticket obtained by kinit earlier to obtain the
necessary security tokens to authenticate with the Gateway.</p>
<p>When this authentication is enabled the first authenticated user that
accesses the system is assigned the admin role as there are no other
users in the system at this point. Any subsequent authenticated user
that access the system starts with no roles. The admin user can then
assign roles to these users. This behavior can be changed by configuring
an external role mapping. Please refer to the <a href="#ExternalRoleMapping">External Role Mapping</a> in the <a href="#ExternalRoles">Authorization using external roles</a> section below for that.</p>
<p>Additional configuration is needed to enable Kerberos authentication for
the Console. A separate set of kerberos credentials are needed. These
can be same as the Hadoop web-service Kerberos credentials which are
typically identified with the principal HTTP/HOST@DOMAIN. A few other
configuration properties are also needed. These can be specified in the
same “dt-site.xml” configuration file as the DT Gateway authentication
configuration described in the Operation and Installation Guide. This
authentication can be set up using the following steps.</p>
<ol>
<li>
<p>Add the following properties to <code>dt-site.xml</code> configuration file, typically located under <code>/opt/datatorrent/current/conf</code> ( or <code>~/datatorrent/current/conf</code> for local install)</p>
<pre><code>&lt;configuration&gt;
...
  &lt;property&gt;
    &lt;name&gt;dt.gateway.http.authentication.type&lt;/name&gt;
    &lt;value&gt;kerberos&lt;/value&gt;
  &lt;/property&gt;
  &lt;property&gt;
    &lt;name&gt;dt.gateway.http.authentication.kerberos.principal&lt;/name&gt;
    &lt;value&gt;{kerberos-principal-of-web-service}&lt;/value&gt;
  &lt;/property&gt;
  &lt;property&gt;
    &lt;name&gt;dt.gateway.http.authentication.kerberos.keytab&lt;/name&gt;
    &lt;value&gt;{absolute-path-to-keytab-file}&lt;/value&gt;
  &lt;/property&gt;
  &lt;property&gt;
    &lt;name&gt;dt.gateway.http.authentication.token.validity&lt;/name&gt;
    &lt;value&gt;{authentication-token-validity-in-seconds}&lt;/value&gt;
  &lt;/property&gt;
  &lt;property&gt;
  &lt;name\&gt;dt.gateway.http.authentication.cookie.domain&lt;/name&gt;
  &lt;value\&gt;{http-cookie-domain-for-authentication-token}&lt;/value&gt;
  &lt;property&gt;
    &lt;name\&gt;dt.gateway.http.authentication.cookie.path&lt;/name&gt;
    &lt;value&gt;{http-cookie-path}&lt;/value&gt;
  &lt;/property&gt;
  &lt;property&gt;
    &lt;name\&gt;dt.gateway.http.authentication.signature.secret&lt;/name&gt;
    &lt;value&gt;{absolute-path-of-secret-file-for-signing-authentication-tokens} &lt;/value&gt;
  &lt;/property&gt;
&lt;/configuration&gt;
</code></pre>
<p>Note that the kerberos principal for web service should begin with
HTTP/…  All the values for the properties above except for the property
<code>dt.gateway.http.authentication.type</code> should be replaced with the
appropriate values for your setup.</p>
</li>
<li>
<p>Restart the Gateway by running</p>
<p><code>sudo service dtgateway restart</code>
( when running Gateway in local mode use  <code>dtgateway restart</code> command)</p>
</li>
</ol>
<h2 id="enabling-jaas-auth">Enabling JAAS Auth</h2>
<p>JAAS is Java Authentication and Authorization Service. It is a pluggable
and extensible mechanism for authentication. It is a generic framework
and the actual authentication is performed by a JAAS plugin module which
can be configured using a configuration file. Among others LDAP and PAM
authentication can be performed via JAAS.</p>
<p>Similar to Kerberos when this authentication is enabled the first
authenticated user that accesses the system is assigned the admin role
as there are no other users in the system at this point. Any subsequent
authenticated user that access the system starts with no roles. The
admin user can then assign roles to these users. This behavior can be
changed by configuring an external role mapping. Please refer to the
<a href="#ExternalRoleMapping">External Role Mapping</a> in the <a href="#ExternalRoles">Authorization using external roles</a> section below for that.</p>
<p>This authentication can be enabled by performing the following general
steps. The specific steps for a couple of authentication mechanisms LDAP
and PAM are shown in the next sections but other authentication
mechanisms that have a JAAS plugin module can also be used.</p>
<ol>
<li>
<p>Add a property to <code>dt-site.xml</code> configuration file, typically located
    under <code>/opt/datatorrent/current/conf</code> ( or
    <code>~/datatorrent/current/conf</code> for local install).</p>
<pre><code>&lt;configuration&gt;
...
  &lt;property&gt;
      &lt;name&gt;dt.gateway.http.authentication.type&lt;/name&gt;
      &lt;value&gt;jaas&lt;/value&gt;
  &lt;/property&gt;
  &lt;property\&gt;
      &lt;name&gt;dt.gateway.http.authentication.jaas.name&lt;/name&gt;
      &lt;value&gt;name-of-jaas-module&lt;/value&gt;
  &lt;/property&gt;
...
&lt;/configuration&gt;
</code></pre>
<p>The <code>dt.gateway.http.authentication.jaas.name</code> property specifies the
plugin module to use with JAAS and the value should be the name of the
plugin module.</p>
</li>
<li>
<p>The name of the plugin module specified above should be configured
    with the appropriate settings for the plugin. This is module
    specific configuration. This can be done in a file named
    .java.login.config in the home directory of the user Gateway is
    running under. If DataTorrent RTS was installed as a superuser,
    Gateway would typically run as dtadmin and this file path would
    typically be <code>/home/dtadmin/.java.login.config</code>, if running as a
    normal user it would be <code>~/.java.login.config</code>. The sample
    configurations for LDAP and PAM are shown in the next sections.</p>
</li>
<li>
<p>The classes for the plugin module may need to be made available to
    Gateway if they are not available in the default classpath. This can
    be done by specifying the jars containing these classes in a
    classpath variable that is used by Gateway.</p>
<p>The following step shows how to do this</p>
<p>a.  Edit the <code>custom-env.sh</code> configuration file, typically located under
    <code>/opt/datatorrent/current/conf</code> ( or <code>~/datatorrent/current/conf</code> for
    local install) and append the list of jars obtained above to the
    DT_CLASSPATH variable. This needs to be added at the end of the
    file in the section for specifying local overrides to environment
    variables. The line would look like</p>
<p><code>export DT\_CLASSPATH=\${DT\_CLASSPATH}:path/to/jar1:path/to/jar2:..</code></p>
</li>
<li>
<p>Restart the Gateway by running</p>
<p><code>sudo service dtgateway restart</code>
( when running Gateway in local mode use  <code>dtgateway restart</code> command)</p>
</li>
</ol>
<h3 id="ldap"><a name="LDAP"></a>LDAP</h3>
<p>LDAP authentication is a directory based authentication mechanism used
in many enterprises. To enable LDAP authentication following are the
specifics for the configuration steps described above.</p>
<ul>
<li>
<p>For step 1 above specify LDAP as the authentication module to use
    with JAAS by first specifying the value of the
    dt.gateway.http.authentication.jaas.name property above to be “ldap”
    (without the quotes). This name should now be configured with the
    appropriate settings as described in the next step.</p>
</li>
<li>
<p>For step 2, the JAAS name specified above should be configured with
    the appropriate LDAP settings in the .java.login.config file. A
    sample configuration is shown below</p>
<pre><code>ldap {
  com.sun.security.auth.module.LdapLoginModule required
  userProvider="ldap://ldap-server-hostname"
  authIdentity="uid={USERNAME},ou=users,dc=domain,dc=com";
};
</code></pre>
</li>
</ul>
<p>Note that the first string before the open brace, in this case
“ldap” must match the jaas name specified in step 1. The first property
within the braces <code>com.sun.security.auth.module.LdapLoginModule</code> specifies
the actual JAAS plugin implementation class providing the LDAP
authentication. The next settings are LDAP settings specific to your
organization and could be different from ones shown above. The above
settings are only provided as a reference example.</p>
<h3 id="pam"><a name="PAM"></a>PAM</h3>
<p>PAM is Pluggable Authentication Module. It is a Linux system equivalent
of JAAS where applications call the generic PAM interface and the actual
authentication implementations called PAM modules are specified using
configuration files. PAM is the login authentication mechanism in Linux
so it can be used for example to authenticate and use local Linux user
accounts in Gateway. If organizations have configured other PAM modules
they can be used in Gateway as well.</p>
<p>PAM is implemented in C language and has C API. JPam is Java PAM bridge
that uses JNI to make PAM calls. It is available here
<a href="http://jpam.sourceforge.net/">http://jpam.sourceforge.net/</a> and has detailed documentation on how to install and set it up. JPam also has a JAAS plugin module and hence can be used in Gateway via JAAS. Note that any other PAM implementation can be used as long as a JAAS plugin module is available.</p>
<p>To enable JPAM following are the specifics for the configuration steps
to enable JAAS authentication described above.</p>
<ul>
<li>
<p>JPAM has to be first installed on the system. Please following the
    installation instructions from the JPAM website.</p>
</li>
<li>
<p>For step 1 above Specify JPAM as the authentication module to use
    with JAAS by first specifying the value of the
    dt.gateway.http.authentication.jaas.name property above to be
    “net-sf-jpam” (without the quotes). This name should now be
    configured with the appropriate settings as described in the next
    step.</p>
</li>
<li>
<p>For step 2 the JAAS name specified above should be configured with
    the appropriate JPAM settings in the .java.login.config file. A
    sample configuration is shown below</p>
<pre><code>net-sf-jpam {
   net.sf.jpam.jaas.JpamLoginModule required serviceName="net-sf-jpam";
};
</code></pre>
</li>
</ul>
<p>Note that the first string before the open brace, in this case
“net-sf-jpam” must match the jaas name specified in step 1. The first
property within the braces net.sf.jpam.jaas.JpamLoginModule specifies
the actual JAAS plugin implementation class providing the JPAM
authentication. The next settings are JPAM specific settings. The
serviceName setting for example specifies the PAM service which would
need to be further configured in /etc/pam.d/net-sf-jpam to specify the
PAM modules to use. Refer to PAM documentation on how to configure a PAM
service with PAM modules. If using Linux local accounts system-auth
could be specified as the PAM module in this file. The above settings
are only provided as a reference example and a different serviceName for
example can be chosen.</p>
<ul>
<li>For step 3 add the JPam jar to the DT_CLASSPATH variable. The JPam
    jar should be available in the JPam installation package and
    typically has the filename format <code>JPam-&lt;version&gt;.jar</code> where
   <code>&lt;version&gt;</code> denotes the version, version 1.1 has been tested.<pre><code>export DT\_CLASSPATH=\${DT\_CLASSPATH}:path/to/JPam-\&lt;version\&gt;.jar
</code></pre>
</li>
</ul>
<h3 id="groups">Groups</h3>
<p>For group support such as using LDAP groups for authorization refer to
the <a href="#ExternalRoles">Authorization using external roles</a> section below.</p>
<h1 id="configuring-authorization">Configuring Authorization</h1>
<p>When any authentication method is enabled, authorization will also be
enabled.  DT Gateway uses roles and permissions for authorization.
 Permissions are possession of the authority to perform certain actions,
e.g. to launch apps, or to add users.  Roles have a collection of
permissions and individual users are assigned to one or more roles.
 What roles the user is in dictates what permissions the user has.</p>
<h2 id="permissions">Permissions</h2>
<p>The list of all possible permissions in the DT Gateway is as follow:</p>
<h3 id="access_rm_proxy"><a name="AccessRMProxy"></a> ACCESS_RM_PROXY</h3>
<p>Allow HTTP proxying requests to YARN’s Resource Manager REST API</p>
<h3 id="edit_global_config"><a name="EditGlobalSettings"></a> EDIT_GLOBAL_CONFIG</h3>
<p>Edit global settings</p>
<h3 id="edit_other_users_config"><a name="EditOtherUsersConfig"></a> EDIT_OTHER_USERS_CONFIG</h3>
<p>Edit other users’ settings</p>
<h3 id="launch_apps"><a name="LaunchApps"></a> LAUNCH_APPS</h3>
<p>Launch Apps</p>
<h3 id="manage_licenses"><a name="ManageLicense"></a>MANAGE_LICENSES</h3>
<p>Manage DataTorrent RTS licenses</p>
<h3 id="manage_other_users_apps"><a name="ManageOtherUsersApps"></a> MANAGE_OTHER_USERS_APPS</h3>
<p>Manage (e.g. edit, kill, etc) applications launched by other users</p>
<h3 id="manage_other_users_app_packages"><a name="ManageOtherUsersAppPackage"></a> MANAGE_OTHER_USERS_APP_PACKAGES</h3>
<p>Manage App Packages uploaded by other users  </p>
<h3 id="manage_roles"><a name="ManageRoles"></a> MANAGE_ROLES</h3>
<p>Manage roles (create/delete roles, or assign permissions to roles)</p>
<h3 id="manage_system_alerts"><a name="ManageSystemAlerts"></a>MANAGE_SYSTEM_ALERTS</h3>
<p>Manage system alerts</p>
<h3 id="manage_users"><a name="ManageUsers"></a> MANAGE_USERS</h3>
<p>Manage users (create/delete users, change password)</p>
<h3 id="upload_app_packages"><a name="UploadAppPackages"></a> UPLOAD_APP_PACKAGES</h3>
<p>Upload App Packages and use the app builder</p>
<h3 id="view_global_config"><a name="ViewGlobalConfig"></a> VIEW_GLOBAL_CONFIG</h3>
<p>View global settings   </p>
<h3 id="view_licenses"><a name="ViewLicenses"></a> VIEW_LICENSES</h3>
<p>View DataTorrent RTS licenses</p>
<h3 id="view_other_users_apps"><a name="ViewOtherUsersApps"></a> VIEW_OTHER_USERS_APPS</h3>
<p>View applications launched by others</p>
<h3 id="view_other_users_app_packages"><a name="ViewOtherUsersAppPackages"></a> VIEW_OTHER_USERS_APP_PACKAGES</h3>
<p>View App Packages uploaded by other users</p>
<h3 id="view_other_users_config"><a name="ViewOtherUsersConfig"></a> VIEW_OTHER_USERS_CONFIG</h3>
<p>Edit other users’ settings</p>
<h3 id="view_system_alerts"><a name="ViewSystemAlerts"></a> VIEW_SYSTEM_ALERTS</h3>
<p>View system alerts</p>
<h2 id="default-roles">Default Roles</h2>
<p>DataTorrent RTS ships with three roles by default. The permissions for
these roles have been set accordingly but can be customized if needed.</p>
<h3 id="admin">Admin</h3>
<p>An administrator of DataTorrent RTS is intended to be able to install,
manage &amp; modify DataTorrent RTS as well as all the applications running
on it. They have ALL the permissions.</p>
<h3 id="operator">Operator</h3>
<p>Operators are intended to ensure DataTorrent RTS and the applications
running on top of it are always up and running optimally. The default
permissions assigned to Operators, enable them to effectively
troubleshoot the entire RTS system and the applications running on it.
Operators are not allowed however to develop or launch new applications.
Operators are also not allowed to make system configuration changes or
manage users.</p>
<p>Here is the list of default permissions given to operators</p>
<p><a href="#ManageSystemAlerts">MANAGE_SYSTEM_ALERTS</a></p>
<p><a href="#ViewGlobalConfig">VIEW_GLOBAL_CONFIG</a></p>
<p><a href="#ViewLicenses">VIEW_LICENSES</a></p>
<p><a href="#ViewOtherUsersApps">VIEW_OTHER_USERS_APPS</a></p>
<p><a href="#ViewOtherUsersAppPackage">VIEW_OTHER_USERS_APP_PACKAGES</a></p>
<p><a href="#ViewSystemAlerts">VIEW_SYSTEM_ALERTS</a></p>
<p>Note that VIEW_OTHER_USERS_APPS and VIEW_OTHER_USERS_APP_PACKAGES
are in the list.  This means all users in the “operator” role will have
read access to all apps and all app packages in the system.  You can
remove those permissions from the “operator” role using the Console if
this is not desirable.  </p>
<h3 id="developer">Developer</h3>
<p>Developers need to have to ability to develop, manage and run
applications on DataTorrent RTS. They are not allowed to change any
system settings or manage licenses.</p>
<p>Here is the list of default permissions given to developers</p>
<p><a href="#LaunchApps">LAUNCH_APPS</a></p>
<p><a href="#UploadAppPackages">UPLOAD_APP_PACKAGES</a></p>
<p><a href="#ManageSystemAlerts">MANAGE_SYSTEM_ALERTS</a></p>
<p><a href="#ViewGlobalConfig">VIEW_GLOBAL_CONFIG</a></p>
<p><a href="#ViewLicenses">VIEW_LICENSES</a></p>
<p><a href="#ViewSystemAlerts">VIEW_SYSTEM_ALERTS</a></p>
<h2 id="app-permissions-and-app-package-permissions">App Permissions and App Package Permissions</h2>
<p>Users can share their running application instances and their
application packages with certain roles or certain users on a
per-instance or per-package basis.  Users can specify which users or
while roles have read-only or read-write access.  In addition, users can
set their own defaults so they does not have to make permission change
every time they launch an app or uploads an app package.</p>
<p>The default for app and app package sharing is that the “operator” role
has read-only permission.</p>
<p>As of RTS 2.0.0, the Console does not yet support managing App
Permissions or App Package Permissions.  But one can manage App
Permissions and App Package Permissions using the Gateway REST API with
URI’s /ws/v2/apps/{appid}/permissions and
/ws/v2/appPackages/{user}/{name}/permissions respectively.  Please refer
to the <a href="https://www.datatorrent.com/docs/guides/DTGatewayAPISpecification.html">DT Gateway REST API document</a> and <a href="#AdministeringUsingCommandLine">here</a> for examples on how to use the REST API.</p>
<h1 id="viewing-and-managing-auth-in-the-console">Viewing and Managing Auth in the Console</h1>
<h2 id="viewing-user-profile">Viewing User Profile</h2>
<p>After you are logged in on the Console, click on the Configuration tab
on the left, and select “User Profile”.  This gives you the information
of the logged in user, including what roles the user is in, and what
permissions the user has.
<img alt="" src="../images/GatewaySecurity/image01.png" />
Administering Auth</p>
<hr />
<p>From the Configuration tab, click on “Auth Management”.  On this page,
you can perform the following tasks:</p>
<ul>
<li>Create new users</li>
<li>Delete users</li>
<li>Change existing users’ passwords</li>
<li>Assign roles to users</li>
<li>Create roles</li>
<li>Assign permissions to roles</li>
</ul>
<p><img alt="" src="../images/GatewaySecurity/image03.png" /></p>
<p>DataTorrent RTS installation comes with three preset roles (admin,
operator, and developer).  You can edit the permissions for those roles
except for admin.</p>
<h1 id="authorization-using-external-roles"><a name="ExternalRoles"></a> Authorization using external roles</h1>
<p>When using an external authentication mechanism such as Kerberos or
JAAS, roles defined in these external systems can be used to control
authorization in DataTorrent RTS. There are two steps involved. First
support for external roles has to be configured in Gateway. This is
described below in the sections <a href="#Kerberos_roles">Kerberos roles</a> and
<a href="#JAAS">JAAS roles</a>. Then a mapping should be specified between
the external roles and DataTorrent roles to specify which role should be
used for a user when the user logs in. How to setup this mapping is
described in the <a href="#ExternalRoleMapping">External Role Mapping</a> section below.
When this mapping is setup only users with roles that have a mapping are
allowed to login the rest are not. The next sections describe how to
configure the system for handling external roles.</p>
<h2 id="kerberos-roles">Kerberos roles <a name="Kerberos_roles"></a></h2>
<p>When Kerberos authentication is used the role for the user is derived
from the principal. If the principal is of the form <em>user/group@DOMAIN</em>
the group portion is used as the external role and no additional
configuration is necessary.</p>
<h2 id="jaas-roles">JAAS roles <a name="JAAS"></a></h2>
<p>To use JAAS roles the system should be configured first to recognize
these roles. When a user is authenticated with JAAS a list of principals
is returned for the user by the implementing JAAS authentication module.
Some of these principals can be for roles and these role principals need
to be identified from the list. Additional configuration is needed to do
this and this configuration is specific to the JAAS authentication
module being used. Specifically the JAVA class name identifying the role
principal needs to be specified. This can be specified using the
property <em>“dt.gateway.http.authentication.jaas.role.class.name”</em> in the
configuration file as shown below</p>
<pre><code>&lt;configuration&gt;
...
  &lt;property&gt;
       &lt;name&gt;dt.gateway.http.authentication.jaas.role.class.name&lt;/name&gt;
          &lt;value&gt;full-class-name-of-role&lt;/value&gt;
 &lt;/property&gt;
...
&lt;/configuration&gt;
</code></pre>

<h3 id="callback-handlers">Callback Handlers</h3>
<p>In JAAS authentication, a login module may need a custom callback to be
handled by the caller. The callbacks are typically used to provide
authentication credentials to the login module. DataTorrent RTS supports
specification of a custom callback handler to handle these callbacks.
The custom callback handler can be specified using the property
“dt.gateway.http.authentication.jaas.callback.class.name”. When this
property is not specified a default callback handler is used but it may
not be sufficient for all login modules like in the LDAP case described
below. The property can be specified as follows</p>
<pre><code>&lt;configuration&gt;
...
&lt;property&gt;                                                                            &lt;name&gt;dt.gateway.http.authentication.jaas.callback.class.name&lt;/name&gt;
&lt;value&gt;full-class-name-of-callback&lt;/value&gt;
&lt;/property&gt;
...
&lt;/configuration&gt;
</code></pre>

<p>Custom callback handlers can be implemented by extending the default
callback handler so they can build upon it or they can be built from
scratch. The LDAP callback handler described below also extends the
default callback handler. The source for the default callback handler
can be found here <em>DefaultCallbackHandler</em> can be used as a reference when
implementing new callback handlers.</p>
<h3 id="ldap_1">LDAP</h3>
<p>When using LDAP with JAAS, to use LDAP roles, a  LDAP login module
supporting roles should be used. Any LDAP module that supports roles can
be used. Jetty implements one such login module. The steps to configure
this module are as follows.</p>
<ol>
<li>
<p>The Gateway service in DataTorrent RTS 2.0 is compatible with Jetty 8. The class name identifying the 
    role principal is <code>“org.eclipse.jetty.plus.jaas.JAASRole”</code>. When using the Jetty LDAP
    login module a custom JAAS callback has to be handled by the caller.
    This has been implemented by DataTorrent in a callback handler. The
    class name for the callback handler implementation should be
    specified as a property. The property name is
    <code>“dt.gateway.http.authentication.jaas.callback.class.name”</code>. The class
    name of the callback handler is
    <code>“com.datatorrent.contrib.security.jetty.JettyJAASCallbackHandler”</code>.
    This property should be specified along with the class name
    identifying the role principal for the Jetty login module as
    described in the section above. The configuration file with all the
    JAAS properties including these looks as follows</p>
<pre><code>&lt;configuration&gt;
...
  &lt;property&gt;
          &lt;name&gt;dt.gateway.http.authentication.type&lt;/name&gt;
          &lt;value&gt;jaas&lt;/value&gt;
  &lt;/property&gt;
  &lt;property&gt;
         &lt;name&gt;dt.gateway.http.authentication.jaas.name&lt;/name&gt;
         &lt;value&gt;ldap&lt;/value&gt;
  &lt;/property&gt;
  &lt;property&gt;  
        &lt;name&gt;dt.gateway.http.authentication.jaas.role.class.name&lt;/name&gt;
         &lt;value&gt;org.eclipse.jetty.plus.jaas.JAASRole&lt;/value&gt;
  &lt;/property&gt;
  &lt;/property&gt;
&lt;name&gt;
    dt.gateway.http.authentication.jaas.callback.class.name &lt;/name&gt;            
&lt;value&gt;
    com.datatorrent.contrib.security.jetty.JettyJAASCallbackHandler
&lt;/value&gt;
  &lt;/property&gt;
...
&lt;/configuration&gt;
</code></pre>
<p>Note that the JAAS callback handler property can be used to specify a
custom callback handler. The source for the Jetty custom callback
handler used above can be found here JettyJAASCallbackHandler</p>
</li>
<li>
<p>An issue was discovered with the Jetty login module supplied with
    Jetty 8 that prevented LDAP authentication to be successful even
    when the user credentials were correct. DataTorrent has a fix for
    this and is providing the login module with the fix in a separate
    package called dt-auth. The classname for the module is
    “com.datatorrent.auth.jetty.JettyLdapLoginModule”. The dt-auth
    project along with the source can be found here <a href="https://github.com/DataTorrent/Auth">Auth</a>. DataTorrent
    is working on submitting this fix back to Jetty project so that it
    gets back into the main source.</p>
<p>The JAAS configuration file as described in
<a href="#LDAP">LDAP</a> section under <a href="#JAAS">Enabling JAAS Auth</a> should be configured to specify the ldap settings
for roles. A sample configuration  roles based parameters to the
configuration shown before</p>
<pre><code>ldap {
        com.datatorrent.auth.jetty.JettyLdapLoginModule required
    hostname="ldap-server-hostname" authenticationMethod="simple"
    userBaseDn="ou=users,dc=domain,dc=com" userIdAttribute="uid"
    userRdnAttribute="uid" roleBaseDn="ou=groups,dc=domain,dc=com"
    roleNameAttribute=”cn”
    contextFactory=”com.sun.jndi.ldap.LdapCtxFactory”;
};
</code></pre>
<p>For more ldap settings refer to the java documentation of the login</p>
</li>
<li>
<p>After the above configuration changes are made the gateway service
    needs to be restarted. Before restarting however the different
    classes specified in the configuration files above namely the
    DataTorrent Jetty callback handler, the Jetty login module with the
    DataTorrent fix and the Jetty dependencies containing the role class
    should all be available for Gateway. This can be done by specifying
    the jars containing these classes in a classpath variable that is
    used by Gateway.</p>
<p>The jars can be obtained from the <a href="https://github.com/DataTorrent/Auth">DataTorrent Auth</a> project.</p>
<p>Please follow the instructions in the above url to obtain the project
jar files. After obtaining the jar files perform the following step to
make them available to Gateway</p>
<p>Edit the custom-env.sh configuration file, typically located under
<code>/opt/datatorrent/current/conf</code> ( or <code>~/datatorrent/current/conf</code> for
local install) and append the list of jars obtained above to the
<code>DT_CLASSPATH</code> variable. This needs to be added at the end of the
file in the section for specifying local overrides to environment
variables. The line would look like</p>
<p><code>export DT\_CLASSPATH=\${DT\_CLASSPATH}:path/to/jar1:path/to/jar2:..</code></p>
</li>
<li>
<p>Restart the Gateway by running</p>
<pre><code>sudo service dtgateway restart
</code></pre>
<p>when running Gateway in local mode use dtgateway restart command.</p>
</li>
</ol>
<h2 id="external-role-mapping">External Role Mapping <a name="ExternalRoleMapping"></a></h2>
<p>External role mapping is specified to map the external roles to the
DataTorrent roles. For example users from an LDAP group called admins
should have the admin role when using the Console. This can be specified
by doing the following steps</p>
<ol>
<li>
<p>In the configuration folder typically located under
    <code>/opt/datatorrent/current/conf</code> ( or <code>~/datatorrent/current/conf</code> for
    local install) edit the file called external-roles or create the
    file if it not already present. In this file each line contains a
    mapping from an external role to a datatorrent role separated by a
    delimiter ‘:’ An example listing is</p>
<pre><code>admins:admin
staff: developer
</code></pre>
<p>This maps the external role admins to the DataTorrent role admin and
external role staff to the DataTorrent role developer.</p>
</li>
<li>
<p>Restart the Gateway by running</p>
<pre><code>sudo service dtgateway restart
</code></pre>
<p>when running Gateway in local mode use  dtgateway restart command</p>
</li>
</ol>
<h1 id="administering-using-command-line">Administering Using Command Line <a name="AdministeringUsingCommandLine"></a></h1>
<p>You can also utilize the <a href="../dtgateway_api/">dtGateway REST API</a> (under /ws/v2/auth) to add or remove users and to change roles and passwords.
 Here are the examples with password authentication.</p>
<h2 id="log-in-as-admin">Log in as admin:</h2>
<pre><code>% curl -c ~/cookie-jar -XPOST -H "Content-Type: application/json" -d '{"userName":"admin","password":"admin"}' http://localhost:9090/ws/v2/login
</code></pre>
<p>This curl command logs in as user “admin” (with the default password
“admin”) and stores the cookie in ~/cookie-jar</p>
<h2 id="changing-the-admin-password">Changing the admin password:</h2>
<pre><code>% curl -b ~/cookie-jar -XPOST -H "Content-Type: application/json" -d '{"newPassword":"xyz"}' http://localhost:9090/ws/v2/auth/users/admin
</code></pre>
<p>This uses the “admin” credential from the cookie jar to change the password to “xyz” for user “admin”.</p>
<h2 id="adding-a-second-admin-user">Adding a second admin user:</h2>
<pre><code>% curl -b ~/cookie-jar -XPUT -H "Content-Type: application/json" -d '{"password":"abc","roles": [ "admin" ] }' http://localhost:9090/ws/v2/auth/users/john
</code></pre>
<p>This command adds a user “john” with password “abc” with admin access.</p>
<h2 id="adding-a-user-in-the-developer-role">Adding a user in the developer role:</h2>
<pre><code>% curl -b \~/cookie-jar -XPUT -H "Content-Type: application/json" -d '{"password":"abc","roles": ["developer"] (http://localhost:9090/ws/v1/login) }' http://localhost:9090/ws/v2/auth/users/jane
</code></pre>
<p>This command adds a user “jane” with password “abc” with the developer role.</p>
<h2 id="listing-all-users">Listing all users:</h2>
<pre><code>% curl -b ~/cookie-jar http://localhost:9090/ws/v2/auth/users
</code></pre>
<h2 id="getting-info-for-a-specific-user">Getting info for a specific user:</h2>
<pre><code>% curl -b ~/cookie-jar http://localhost:9090/ws/v2/auth/users/john
</code></pre>
<p>This command returns the information about the user “john”.</p>
<h2 id="removing-a-user">Removing a user:</h2>
<pre><code>% curl -b ~/cookie-jar -XDELETE http://localhost:9090/ws/v2/auth/users/jane
</code></pre>
<p>This command removes the user “jane”.</p>
<h1 id="enabling-https-in-gateway">Enabling HTTPS in Gateway</h1>
<p>HTTPS in the Gateway can be enabled by performing following two steps.</p>
<ol>
<li>
<p>Generate an SSL keystore if you don’t have one.  Instruction on how to generate an SSL keystore is here: <a href="http://docs.oracle.com/cd/E19509-01/820-3503/ggfen/index.html">http://docs.oracle.com/cd/E19509-01/820-3503/ggfen/index.html</a></p>
</li>
<li>
<p>Add a property to dt-site.xml configuration file, typically located under <code>/opt/datatorrent/current/conf</code> ( or <code>~/datatorrent/current/conf</code> for local install).</p>
<pre><code>&lt;configuration&gt;
...
  &lt;property&gt;
           &lt;name&gt;dt.gateway.sslKeystorePath&lt;/name&gt;
           &lt;value&gt;{/path/to/keystore}&lt;/value&gt;
  &lt;/property&gt;
  &lt;property&gt;
            &lt;name&gt;dt.gateway.sslKeystorePassword&lt;/name&gt;
             &lt;value&gt;{keystore-password}&lt;/value&gt;
  &lt;/property&gt;
  &lt;property&gt;
    &lt;name&gt;dt.attr.GATEWAY_USE_SSL&lt;/name&gt;
          &lt;value&gt;true&lt;/value&gt;
  &lt;/property&gt;
...
&lt;/configuration&gt;
</code></pre>
</li>
<li>
<p>Restart the Gateway by running</p>
<pre><code>sudo service dtgateway restart
</code></pre>
<p>( when running Gateway in local mode use <code>dtgateway restart</code> command)</p>
</li>
</ol>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../coming_soon/" class="btn btn-neutral float-right" title="dtCli"/>Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../coming_soon/" class="btn btn-neutral" title="Configuration"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../coming_soon/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../coming_soon/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>

</body>
</html>
